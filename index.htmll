<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø¨Ø±ÙŠØ¯ Ù…Ø¤Ù‚Øª Ù…Ù…ÙŠØ²</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
            padding: 30px;
        }
        #email {
            font-size: 20px;
            margin: 20px 0;
            padding: 10px;
            border: 2px dashed #0f0;
            display: inline-block;
            background: #222;
        }
        .msg {
            background: #222;
            border: 1px solid #444;
            margin: 10px auto;
            padding: 10px;
            width: 90%;
            max-width: 600px;
            text-align: left;
        }
        #copyBtn {
            background-color: #0f0;
            color: #000;
            padding: 8px 16px;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>ðŸ“§ Ø¨Ø±ÙŠØ¯ Ù…Ø¤Ù‚Øª Ø¨ØµÙŠØºØ© Ù…Ù…ÙŠØ²Ø©</h1>
    <div id="email">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...</div>
    <br>
    <button id="copyBtn" onclick="copyEmail()">ðŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
    <h2>ðŸ“¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
    <div id="messages">Ø§Ù†ØªØ¸Ø±...</div>

    <script>
        let currentEmail = "";

        async function getMail() {
            const domainList = ["kdm1.com", "lwl.jp", "tutanota.com"];
            const rand = Math.random().toString(36).substring(2, 9);
            const randomDomain = domainList[Math.floor(Math.random() * domainList.length)];
            const email = `${rand}@${randomDomain}`;
            currentEmail = email;

            const res = await fetch("https://api.mail.tm/accounts", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ address: email, password: "12345678" })
            });

            const tokenRes = await fetch("https://api.mail.tm/token", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ address: email, password: "12345678" })
            });

            const tokenData = await tokenRes.json();
            const token = tokenData.token;

            document.getElementById("email").innerText = email;

            checkMessages(token);
        }

        async function checkMessages(token) {
            const res = await fetch("https://api.mail.tm/messages", {
                headers: { Authorization: `Bearer ${token}` }
            });

            const data = await res.json();
            const msgs = data["hydra:member"];
            const container = document.getElementById("messages");
            container.innerHTML = "";

            if (msgs.length === 0) {
                container.innerHTML = "ðŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯";
                setTimeout(() => checkMessages(token), 5000);
                return;
            }

            msgs.forEach(msg => {
                const div = document.createElement("div");
                div.className = "msg";
                div.innerHTML = `<strong>Ù…Ù†:</strong> ${msg.from.address}<br><strong>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</strong> ${msg.subject}<br><strong>Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</strong> ${msg.intro}`;
                container.appendChild(div);
            });
        }

        function copyEmail() {
            navigator.clipboard.writeText(currentEmail).then(() => {
                const btn = document.getElementById("copyBtn");
                btn.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!";
                setTimeout(() => {
                    btn.innerText = "ðŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯";
                }, 2000);
            });
        }

        getMail();
    </script>
</body>
</html>
